<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HexMapLibrary: Minimal Example 3: A simple real time example - spawning some random walkers belonging to different teams and have them capture tiles</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HexMapLibrary
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">HexMap Library Documentation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Minimal Example 3: A simple real time example - spawning some random walkers belonging to different teams and have them capture tiles </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>While hexagonal grids are mostly used for round based games there is nothing stopping us from building a real-time game based on such a grid. In this very basic example we will spawn a few units and have them capture the tile they move onto and display how many tiles are currently owned by Team A, Team B or are neutral. To stress test things a bit we will create a way bigger map this time and spawn 200 units which will walk around randomly. For this example we will create two scripts one for the map and one for the units.</p>
<p>most of the code for the map is the similar to the earlier examples so we wil skip that. The new part we added is spawning a certain amount of units in the start method:</p>
<div class="fragment"><div class="line"><span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; UnitAmount; i++)</div><div class="line">{</div><div class="line">    GameObject unit = Instantiate(UnitPrefab);</div><div class="line">    MinimalExample3GenericAgent agentComponent = unit.GetComponent&lt;MinimalExample3GenericAgent&gt;();</div><div class="line"></div><div class="line">    <span class="keywordtype">int</span> randomNumber = Random.Range(0, hexMap.TileCount); <span class="comment">// we seleect  a random tile to spawn it the unit on</span></div><div class="line"></div><div class="line">    agentComponent.Init(hexMap, hexMap.Tiles[randomNumber].CartesianPosition, i%2 +1, <span class="keyword">this</span> ); <span class="comment">// we spawn the unit, assign a spawn position, a teamID and set up needed references</span></div><div class="line">}</div></div><!-- fragment --><p>Then we also create a method which is called by the units to inform which tile they are on and marks them for a potential change:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> MarkTileAsOwned(Tile&lt;int&gt; tile, <span class="keywordtype">int</span> teamID)</div><div class="line">{</div><div class="line">    <span class="keywordflow">if</span> (TilesMarkedAsOwned.ContainsKey(tile))</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (TilesMarkedAsOwned[tile] == teamID) <span class="keywordflow">return</span>; <span class="comment">//if it is in the dictionary but from same team then we just do nothing</span></div><div class="line">        TilesMarkedAsOwned[tile] = -1; <span class="comment">//we flag those with multiple units from different teams on it with -1 and won&#39;t change them.</span></div><div class="line">    }</div><div class="line">    <span class="keywordflow">else</span> TilesMarkedAsOwned.Add(tile, teamID);</div><div class="line">}</div></div><!-- fragment --><p>and finally we check during LateUpdate (to not have to bother with script execution order) which tiles got marked by all the different unit and update the map:</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> LateUpdate()</div><div class="line">{</div><div class="line">    <span class="keywordflow">foreach</span>(var kvp <span class="keywordflow">in</span> TilesMarkedAsOwned)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">if</span> (kvp.Value == -1) <span class="keywordflow">continue</span>; <span class="comment">// we skip those marked by multiple agents;</span></div><div class="line">        kvp.Key.Data = kvp.Value;</div><div class="line">        tileObjects[kvp.Key.Index].GetComponent&lt;Renderer&gt;().material = materials[kvp.Value];</div><div class="line">    }</div><div class="line">    TilesMarkedAsOwned.Clear();</div><div class="line">}</div></div><!-- fragment --><p>Now what we are still missing is the unit script. We will keep it very simple and just have the units pick a random targer and once they are close to it, they pick a new one. Additionally they will call the MarkTIleAsOwned method from the previous script.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>MinimalExample3GenericAgent : MonoBehaviour</div><div class="line">{</div><div class="line">    [SerializeField]</div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">float</span> speed = 1; <span class="comment">//set to any value in inspector</span></div><div class="line">    <span class="keyword">private</span> <span class="keywordtype">int</span> teamID;</div><div class="line"></div><div class="line">    <span class="keyword">private</span> HexMap&lt;int&gt; hexMap;</div><div class="line">    <span class="keyword">private</span> MinimalExample3Generic minimalExample3Script;</div><div class="line">    <span class="keyword">private</span> Vector3 currentTarget;</div><div class="line">    <span class="keyword">private</span> Tile&lt;int&gt; currentTile;</div><div class="line"></div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">void</span> Init(HexMap&lt;int&gt; hexMap, Vector3 spawnPosition, <span class="keywordtype">int</span> teamID, MinimalExample3Generic exampleScript)</div><div class="line">    {</div><div class="line">        this.hexMap = hexMap;</div><div class="line">        this.teamID = teamID;</div><div class="line">        transform.position = spawnPosition;</div><div class="line">        currentTarget = transform.position;</div><div class="line">        transform.LookAt(currentTarget);</div><div class="line">        minimalExample3Script = exampleScript;    </div><div class="line">        <span class="keywordflow">if</span>(teamID == 1)</div><div class="line">        {</div><div class="line">            GetComponent&lt;Renderer&gt;().material.color = Color.green;</div><div class="line">        }</div><div class="line">        <span class="keywordflow">else</span> GetComponent&lt;Renderer&gt;().material.color = Color.red;</div><div class="line">    }</div><div class="line"></div><div class="line">    <span class="comment">// Update is called once per frame</span></div><div class="line">    <span class="keywordtype">void</span> Update()</div><div class="line">    {            </div><div class="line">        <span class="keywordflow">if</span> (Vector3.Distance(transform.position, currentTarget) &lt;= 2 * Time.deltaTime * speed) <span class="comment">//once we are close to target we pick a new one</span></div><div class="line">        {                </div><div class="line">            <span class="keywordtype">int</span> randomNumber = Random.Range(0, hexMap.TileCount);</div><div class="line">            currentTarget = hexMap.Tiles[randomNumber].CartesianPosition;</div><div class="line">        }</div><div class="line"></div><div class="line">        transform.LookAt(currentTarget);</div><div class="line">        transform.Translate(Vector3.forward * speed * Time.deltaTime);</div><div class="line"></div><div class="line">        Vector3Int newPosition = HexConverter.CartesianCoordToCubeCoord(transform.position);</div><div class="line">        minimalExample3Script.MarkTileAsOwned(hexMap.TilesByPosition[newPosition], teamID);</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>The completed example is also included in the package, just open the MinimalExample3 scene. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
