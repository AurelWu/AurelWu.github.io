<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.14"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>HexMapLibrary: Minimal Example 5: using multiple maps</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">HexMapLibrary
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.14 -->
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',false,false,'search.php','Search');
});
/* @license-end */</script>
<div id="main-nav"></div>
<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="index.html">HexMap Library Documentation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Minimal Example 5: using multiple maps </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In this Example we will create multiple maps which have teleporters allowing us to move our unit between them.</p>
<p>At first we will define a custom class, unlike the previous examples we want each tile to contain a bit more info than before. Each tile will know if it is a teleporter or not and if it is, it will have a Target map and position.</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">class </span>E5TileData</div><div class="line">{</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> TerrainValue { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">bool</span> HasTeleporter { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div><div class="line">    <span class="keyword">public</span> <span class="keywordtype">int</span> MapIndexTeleportTarget { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div><div class="line">    <span class="keyword">public</span> Vector3Int MapPositionTeleportTarget { <span class="keyword">get</span>; <span class="keyword">private</span> <span class="keyword">set</span>; }</div><div class="line"></div><div class="line">    <span class="keyword">public</span> E5TileData(<span class="keywordtype">int</span> value,<span class="keywordtype">bool</span> hasTeleporter, <span class="keywordtype">int</span> mapIndexTeleportTarget, Vector3Int mapPositionTeleportTarget)</div><div class="line">    {</div><div class="line">        this.TerrainValue = value;</div><div class="line">        this.HasTeleporter = hasTeleporter;</div><div class="line">        this.MapIndexTeleportTarget = mapIndexTeleportTarget;</div><div class="line">        this.MapPositionTeleportTarget = mapPositionTeleportTarget;</div><div class="line">    }</div><div class="line">}</div></div><!-- fragment --><p>Now it is time for our main script, lets start with the variables we are going to need:</p>
<div class="fragment"><div class="line"><span class="comment">//[...]</span></div><div class="line">[SerializeField] <span class="keyword">private</span> GameObject unitGameObject = null; <span class="comment">// the unit we will move around, we won&#39;t instantiate that one in code but put it in the scene and just reference in the inspector</span></div><div class="line">[SerializeField] <span class="keyword">private</span> GameObject hexPrefab = null; <span class="comment">// the hexagon mesh prefab we use in all the examples</span></div><div class="line">[SerializeField] <span class="keyword">private</span> GameObject teleporterPrefab = null; <span class="comment">// a prefab which represents the teleporter (just the visuals)</span></div><div class="line">[SerializeField] <span class="keyword">private</span> List&lt;Material&gt; materials = null; <span class="comment">// the usual list of materials we assign to the hexagons based on tile value.</span></div><div class="line"></div><div class="line"><span class="keyword">private</span> HexMap&lt;E5TileData, int&gt;[] hexMaps; <span class="comment">// an array of our HexMaps</span></div><div class="line"><span class="keyword">private</span> GameObject[][] tileObjectsByMap; <span class="comment">// a jagged array which contain all the Hexagon-GameObjects for all our maps</span></div><div class="line"><span class="keyword">private</span> GameObject[] mapParents; <span class="comment">// an array with the transform parents for each map</span></div><div class="line"></div><div class="line"><span class="keyword">private</span> HexMap&lt;E5TileData, int&gt; activeHexMap; <span class="comment">// this will be always the one our unit is on</span></div><div class="line"><span class="keyword">private</span> Vector3Int unitPosition; <span class="comment">// for this minimal example we don&#39;t create a separate unit class ... don&#39;t do it like this at home!        </span></div><div class="line"><span class="keyword">private</span> HexMouse hexMouse = null;</div><div class="line"><span class="comment">//[...]</span></div></div><!-- fragment --><p>And now we create our 3 maps, this is pretty much the same as in the other examples, just that we create 3 instead of 1 and add a few more references in arrays to be able to access them comfortably. All 3 Maps will be put in the same visual space but we will always disable the non-active ones.</p>
<div class="fragment"><div class="line"><span class="keywordtype">void</span> Start ()</div><div class="line">{</div><div class="line">    hexMaps = <span class="keyword">new</span> HexMap&lt;E5TileData, int&gt;[3];</div><div class="line">    mapParents = <span class="keyword">new</span> GameObject[hexMaps.Length];</div><div class="line">    tileObjectsByMap = <span class="keyword">new</span> GameObject[hexMaps.Length][];</div><div class="line">    hexMaps[0] = <span class="keyword">new</span> HexMap&lt;E5TileData, int&gt;(MapShape.CreateRectangularShapedMap(<span class="keyword">new</span> Vector2Int(10,10)), <span class="stringliteral">&quot;FirstMap&quot;</span>);</div><div class="line">    hexMaps[1] = <span class="keyword">new</span> HexMap&lt;E5TileData, int&gt;(MapShape.CreateTriangularShapedMap(10), <span class="stringliteral">&quot;SecondMap&quot;</span>);</div><div class="line">    hexMaps[2] = <span class="keyword">new</span> HexMap&lt;E5TileData, int&gt;(MapShape.CreateHexagonalShapedMap(5), <span class="stringliteral">&quot;ThirdMap&quot;</span>);</div><div class="line">    </div><div class="line">    <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt; hexMaps.Length; i++)</div><div class="line">    {</div><div class="line">        GameObject[] tileObjects = <span class="keyword">new</span> GameObject[hexMaps[i].TileCount];</div><div class="line">        mapParents[i] = <span class="keyword">new</span> GameObject(hexMaps[i].Name);</div><div class="line">        <span class="keywordflow">foreach</span>(var tile <span class="keywordflow">in</span> hexMaps[i].Tiles)</div><div class="line">        {</div><div class="line">            tile.Data = <span class="keyword">new</span> E5TileData(Random.Range(0,4),<span class="keyword">false</span>,-1,Vector3Int.zero);</div><div class="line">            GameObject instance = GameObject.Instantiate(hexPrefab);</div><div class="line">            instance.GetComponent&lt;Renderer&gt;().material = materials[tile.Data.TerrainValue];</div><div class="line">            instance.name = <span class="stringliteral">&quot;MapTile_&quot;</span> + tile.Position;</div><div class="line">            instance.transform.position = tile.CartesianPosition;</div><div class="line">            instance.transform.parent = mapParents[i].transform;</div><div class="line">            tileObjects[tile.Index] = instance;</div><div class="line">        }</div><div class="line">        tileObjectsByMap[i] = tileObjects;</div><div class="line">        </div><div class="line">        hexMouse = gameObject.AddComponent&lt;HexMouse&gt;(); </div><div class="line">        hexMouse.Init(activeHexMap, <span class="keyword">true</span>);</div><div class="line"></div><div class="line">        <span class="comment">//some more things we set up at start</span></div><div class="line">        activeHexMap = hexMaps[0];</div><div class="line">        unitPosition = Vector3Int.zero;</div><div class="line">        unitGameObject.transform.position = Vector3.zero;</div><div class="line">        unitGameObject.transform.parent = mapParents[0].transform;</div><div class="line">        mapParents[1].SetActive(<span class="keyword">false</span>);</div><div class="line">        mapParents[2].SetActive(<span class="keyword">false</span>);</div><div class="line"></div><div class="line">        Camera.main.transform.position = <span class="keyword">new</span> Vector3(activeHexMap.Center.x, 5, activeHexMap.Center.z);</div><div class="line">        Camera.main.orthographic = <span class="keyword">true</span>;</div><div class="line">        Camera.main.orthographicSize = activeHexMap.MapBoundingBoxSize.y * 0.8f;</div><div class="line">}</div></div><!-- fragment --><p>As next step we are going to change some Tiles to act as teleporters. for that we create an AddTeleporterMethod:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> AddTeleporter(<span class="keywordtype">int</span> originMap, <span class="keywordtype">int</span> targetMap, Vector3Int originPosition, Vector3Int targetPosition)</div><div class="line">{</div><div class="line">    hexMaps[originMap].TilesByPosition[originPosition].Data = <span class="keyword">new</span> E5TileData(3, <span class="keyword">true</span>, targetMap, targetPosition);</div><div class="line">    GameObject teleporterObject1 = GameObject.Instantiate(teleporterPrefab);</div><div class="line">    teleporterObject1.transform.position = HexConverter.CubeCoordToCartesianCoord(originPosition);</div><div class="line">    teleporterObject1.transform.parent = mapParents[originMap].transform;</div><div class="line">}</div></div><!-- fragment --><p>and in our start method we add:</p>
<div class="fragment"><div class="line">AddTeleporter(0, 2, <span class="keyword">new</span> Vector3Int(2, 1, -3), Vector3Int.zero);</div><div class="line">AddTeleporter(1, 0, <span class="keyword">new</span> Vector3Int(0, 3, -3), Vector3Int.zero);</div><div class="line">AddTeleporter(2, 1, <span class="keyword">new</span> Vector3Int(3, 2, -5), Vector3Int.zero);</div></div><!-- fragment --><p>This will create one 1-Way teleporter on each map. All what is missing now is the method to move our unit and teleport it when we move on a teleporter tile:</p>
<div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keywordtype">void</span> MoveUnit(<span class="keywordtype">int</span> value)</div><div class="line">{</div><div class="line">    Vector3Int direction = Vector3Int.zero;</div><div class="line">    <span class="keywordflow">switch</span> (value)</div><div class="line">    {</div><div class="line">        <span class="keywordflow">case</span> 0:</div><div class="line">            direction = <span class="keyword">new</span> Vector3Int(0, 1, -1); <span class="comment">//top right</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 1:</div><div class="line">            direction = <span class="keyword">new</span> Vector3Int(1, 0, -1); <span class="comment">//right</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 2:</div><div class="line">            direction = <span class="keyword">new</span> Vector3Int(1, -1, 0); <span class="comment">//bottom right</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 3:</div><div class="line">            direction = <span class="keyword">new</span> Vector3Int(0, -1, 1); <span class="comment">//bottom left</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 4:</div><div class="line">            direction = <span class="keyword">new</span> Vector3Int(-1, 0, 1); <span class="comment">//left</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">case</span> 5:</div><div class="line">            direction = <span class="keyword">new</span> Vector3Int(-1, 1, 0); <span class="comment">//top left;</span></div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">        <span class="keywordflow">default</span>:</div><div class="line">            <span class="keywordflow">break</span>;</div><div class="line">    }</div><div class="line"></div><div class="line">    Vector3Int targetPos = unitPosition + direction;</div><div class="line">    <span class="keywordflow">if</span> (!activeHexMap.TilesByPosition.ContainsKey(targetPos)) <span class="keywordflow">return</span>;</div><div class="line">    <span class="keywordflow">if</span>(activeHexMap.TilesByPosition[targetPos].Data.HasTeleporter)</div><div class="line">    {</div><div class="line">        E5TileData tileData = activeHexMap.TilesByPosition[targetPos].Data;</div><div class="line">        targetPos = tileData.MapPositionTeleportTarget;</div><div class="line">        <span class="keywordtype">int</span> targetMapIdx = tileData.MapIndexTeleportTarget;</div><div class="line">        activeHexMap = hexMaps[targetMapIdx];</div><div class="line">        unitGameObject.transform.parent = mapParents[targetMapIdx].transform;</div><div class="line">        <span class="keywordflow">for</span>(<span class="keywordtype">int</span> i = 0; i &lt;mapParents.Length; i++)</div><div class="line">        {</div><div class="line">            <span class="keywordflow">if</span> (i == targetMapIdx)</div><div class="line">            {</div><div class="line">                mapParents[i].SetActive(<span class="keyword">true</span>); <span class="comment">// we activate the target MapParent so all children of it are visible</span></div><div class="line">            }</div><div class="line">            <span class="keywordflow">else</span></div><div class="line">            {</div><div class="line">                mapParents[i].SetActive(<span class="keyword">false</span>); <span class="comment">// we deactivate all the others MapParents</span></div><div class="line">            }</div><div class="line">        }</div><div class="line">        Camera.main.transform.position = <span class="keyword">new</span> Vector3(activeHexMap.Center.x, 5, activeHexMap.Center.z); <span class="comment">//we adjust the camera settings</span></div><div class="line">        Camera.main.orthographic = <span class="keyword">true</span>;</div><div class="line">        Camera.main.orthographicSize = activeHexMap.MapBoundingBoxSize.y * 0.8f;</div><div class="line">    }</div><div class="line"></div><div class="line">    unitPosition = targetPos; <span class="comment">//we update the units hexagon position</span></div><div class="line">    unitGameObject.transform.position = HexConverter.CubeCoordToCartesianCoord(targetPos); <span class="comment">//we update the units visual position</span></div><div class="line">}</div></div><!-- fragment --><p>The final step is to add a way to call MoveUnit . You can create 6 UI buttons which call it, or add some hotkeys or whatever you like.</p>
<p>The completed example scene (using buttons for movement) is also included. </p>
</div></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.14
</small></address>
</body>
</html>
